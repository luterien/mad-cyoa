<div>

	<script type="text/javascript"></script>
	<style type="text/css">

		.page-item {
			margin-bottom: 12px;
			font-size: 13px;
			width: 100%; 
		}

		.choice-container {
			padding: 10px 0;
			width: 800px; overflow: auto;
		}

		.choice_go {
			width: 36px; float: left;
		}

		.choice_name {
			width: 418px; float: left;
		}
		.choice_name textarea {
			width: 418px; 
		}

		.choice_opts {
			width: 259px; float: left; padding-left: 10px;
		}
		.choice_opts select {
			width: 259px; height: 34px;
		}

		.choice_action {
			width: 36px; float: right; text-align: right;
		}
		.choice_action a {
			color: #000;
		}

		.choice_remove {
			width: 36px; float: right; text-align: left;
		}

		.choice-container img {
			width: 24px; height: 24px;
			position: relative; top: 3px;
			margin: 0 0 0 12px;
		}

		.choice_remove img {
			width: 18px; height: 18px;
			position: relative; top: 6px;
			margin: 0 0 0 12px;
		}

	</style>

	<div class="frm">

		<div class="page-item">
			<div class="source_choices">
				{% for choice in snippet.sources.all %}
				{% include 'include/source_single.html' %}
				{% endfor %}
			</div>
			<div class="choice-container add_source_choice">
				<span style="background:#eee; padding:5px 10px;">
					<span id="{{ choice.source.slug }}">+</span>
				</span>
			</div>
		</div>

		<div class="page-item">
			<textarea id="snippet_text" style="width:100%;" rows="8">{{ snippet.text }}</textarea>
		</div>

		<div class="page-item">
			<div class>
				<div class="target_choices">
					{% for choice in snippet.targets.all %}
					{% include 'include/target_single.html' %}
					{% endfor %}
				</div>
				<div class="choice-container add_target_choice">
					<span style="background:#eee; padding:5px 10px;">
						<span id="{{ choice.source.slug }}">+</span>
					</span>
				</div>
			</div>
		</div>

		<div class="page-item">
			<input type="hidden" name="csrfmiddlewaretoken" class="csrfmiddlewaretoken" value="{{ csrf_token }}">
			<input type="hidden" value="{{ snippet.id }}" class="snippet_id">
			<input type="submit" value="save" id="sv_form">
		</div>

	</div>

</div>

<script type="text/javascript">

	$(document).ready(function() {

		$(".delete_choice").on('click', function(){
			var el = $(this).closest(".choice-container");
			$.ajax({
	        	method: "POST",
	        	url: "{% url 'delete-choice' %}",
	        	data: {
	        		"choice_id": $(this).attr("id"),
	        		"csrfmiddlewaretoken": $(".csrfmiddlewaretoken").val(),
	        	},
	        	success:function(data) {
			        el.remove();
			        window.parent.toast("Choice Deleted");
			    } 
			})
		});

		$(".add_source_choice").on('click', function(){
			$.ajax({
	        	method: "POST",
	        	url: "{% url 'add-source-choice' %}",
	        	data: {
	        		"snippet_id": $(".snippet_id").val(),
	        		"csrfmiddlewaretoken": $(".csrfmiddlewaretoken").val(),
	        	},
	        	success:function(data) {
			        $(".source_choices").html(data);
			        window.parent.toast("Updated");
			    } 
			})
		});

		$(".add_target_choice").on('click', function(){
			$.ajax({
	        	method: "POST",
	        	url: "{% url 'add-target-choice' %}",
	        	data: {
	        		"snippet_id": $(".snippet_id").val(),
	        		"csrfmiddlewaretoken": $(".csrfmiddlewaretoken").val(),
	        	},
	        	success:function(data) {
			        $(".target_choices").html(data);
			        window.parent.toast("Updated");
			    } 
			})
		});

		$(".source_action").on('click', function(){
			var data = {
	        		"choice_id": $(this).attr("id"),
	        		"source_id": $(this).closest(".choice-container").find("select").find("option:selected").attr("id"),
	        		"choice_text": $(this).closest(".choice-container").find("textarea").val(),
	        		"csrfmiddlewaretoken": $(".csrfmiddlewaretoken").val(),
	        	};
			$.ajax({
	        	method: "POST",
	        	url: "{% url 'update-source-choice' %}",
	        	data: data,
	        	success:function(data) {
			        window.parent.toast("Updated");
			    } 
			})
		});

		$(".target_action").on('click', function(){
			var data = {
	        		"choice_id": $(this).attr("id"),
	        		"target_id": $(this).closest(".choice-container").find("select").find("option:selected").attr("id"),
	        		"choice_text": $(this).closest(".choice-container").find("textarea").val(),
	        		"csrfmiddlewaretoken": $(".csrfmiddlewaretoken").val(),
	        	};
			$.ajax({
	        	method: "POST",
	        	url: "{% url 'update-target-choice' %}",
	        	data: data,
	        	success:function(data) {
			        window.parent.toast("Updated");
			    } 
			})
		});

		$(".choice_go a").on('click', function(){
			var slug = $(this).attr("id");
			window.parent.loadFancy(slug);
		});

		// testing
		$("#sv_form").on('click', function(){

			var snippet_id = $(".snippet_id").val();
			var snippet_content = $("#snippet_text").val();
			var csrfmiddlewaretoken = $(".csrfmiddlewaretoken").val();

			var data =  {
        		"content": snippet_content, 
        		"snippet_id": snippet_id,
        		"csrfmiddlewaretoken": csrfmiddlewaretoken,
	        };

			$.ajax({
	        	method: "POST",
	        	url: "{% url 'update-snippet' %}",
	        	data: {
	        		"content": snippet_content, 
	        		"snippet_id": snippet_id,
	        		"csrfmiddlewaretoken": csrfmiddlewaretoken,
	        	},
	        	success:function(data) {
			        console.log(data);
			        window.parent.toast("Content Changed");
			    } 
	        })

		});

		// save
		/*
		$.ajax({
        	method: "POST",
        	url: "{% url 'update-snippet' %}",
        	data: {"status": status, "game_id": "{{ game.id }}"},
        	success:function(data) {
		        $(".ntfy").html("Updated");
		        $('.ntfy').fadeIn(400).delay(1500).fadeOut(400); //fade out after 3 seconds
		    } 
        });*/

	});
</script>
